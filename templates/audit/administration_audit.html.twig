{% extends 'base.html.twig' %}

{% block title %}
    Administration audit
{% endblock %}

{% block stylesheets %}
    <!-- Datatables -->
    {{ parent() }}

    <link href="../vendor/jquery-ui-1.12.1/jquery-ui.min.css" rel="stylesheet">
    <link href="../css/input_custom.css" rel="stylesheet">





{% endblock %}
{% block body %}
    {{ parent() }}
    <div class="right_col" role="main">
        <div class="">
            <div class="clearfix"></div>
            <div class="row">
                            <div class="x_content">
                                <div id="accordion">
                                    <h1>Créer une nouvelle phase d'audit</h1>
                                        <div class="container">
                                            <div class="col-md-12 col-sm-12 col-xs-12">
                                                    <div class="x_content">
                                                        <br />
                                                        <form id="demo-form2" data-parsley-validate class="" method="post" action="../administration-audit">
                                                        <div class="row">
                                                            <div class="form-group col-md-6 col-sm-6 col-xs-12 col-md-offset-3">
                                                                    <label>Intitulé de la phase</label>
                                                                    <input type="text" id="first-name" required="required" class="form-control col-md-6 col-xs-12" name="name_phase">
                                                            </div>
                                                        </div>
                                                            <div class="row">
                                                                    <div class="table-responsive col-md-12 col-sm-12">
                                                                        <table class="table table-hover table-striped">
                                                                            <thead>
                                                                                <tr>
                                                                                    <th>
                                                                                        Test
                                                                                    </th>
                                                                                    <th>
                                                                                        Type
                                                                                    </th>
                                                                                    <th>
                                                                                        Priorité
                                                                                    </th>
                                                                                    <th>
                                                                                        Famille
                                                                                    </th>
                                                                                    <th>
                                                                                    </th>
                                                                                </tr>
                                                                            </thead>
                                                                            <tbody>
                                                                            <tr>
                                                                                <td>
                                                                                    <div class="form-group col-md-6 col-sm-6 col-xs-12">
                                                                                        <input type="text" name="test_phase[1][parent]" class="input_test" placeholder="Ajouter un test" required>
                                                                                        <div class="bar"></div>
                                                                                    </div>
                                                                                </td>
                                                                                <td>
                                                                                    <div class="form-group">
                                                                                        <select class="form-control" name="test_phase[1][type]" id="sel1">
                                                                                            {% for t in test_type %}
                                                                                                <option>{{ t.type }}</option>
                                                                                            {% endfor %}
                                                                                        </select>
                                                                                    </div>
                                                                                </td>
                                                                                <td>
                                                                                    <div class="form-group">
                                                                                        <select class="form-control" name="test_phase[1][prio]" id="sel1">
                                                                                            <option>1</option>
                                                                                            <option>2</option>
                                                                                            <option>3</option>
                                                                                        </select>
                                                                                    </div>
                                                                                </td>
                                                                                <td>
                                                                                    <div class="input-group col-md-6 col-sm-6 col-xs-12">
                                                                                        <span class="input-group-addon"><a  class="glyphicon glyphicon-minus remove-child" style=" pointer-events: none;cursor: default;"></a></span>
                                                                                        <input type="text" name="test_phase[1][child][]" class="input_test" placeholder="Ajouter un test enfant">
                                                                                        <div class="bar"></div>
                                                                                        <span class="input-group-addon"><a href="#" class="glyphicon glyphicon-plus add-child"></a></span>
                                                                                    </div>
                                                                                </td>
                                                                                <td>
                                                                                    <a href="#" class="add-row"><span class="glyphicon glyphicon-plus"></span></a>
                                                                                </td>
                                                                            </tr>
                                                                            </tbody>
                                                                        </table>
                                                                    </div>
                                                            </div>
                                                            <div class="form-group">
                                                                <div class="col-md-6 col-sm-6 col-xs-12 col-md-offset-3">
                                                                    <button type="submit" class="btn btn-success" name="submit" value="newPhase" >Soumettre</button>
                                                                </div>
                                                            </div>
                                                        </form>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                {% for phase in phases %}
                <div class="row" id="table{{ phase.id }}">
                    <div class="col-md-12 col-sm-12 col-xs-12">
                        <div class="panel panel-primary shadow">
                            <div class="panel-heading"><h2>{{ phase.phase_name }}</h2></div>
                                <table id="myTable" class="myTable table table-striped table-bordered bulk_action dataTable no-footer" style="padding: 1%">
                                    <thead>
                                    <tr>
                                        <th>
                                            <input type="checkbox"  class="flat">
                                        </th>
                                        <th>Test</th>
                                        <th>Priorité</th>
                                    </tr>
                                    </thead>

                                    <tbody>
                                    {% for test in tests %}
                                        {% if test.idPhase.id == phase.id %}
                                            <tr>
                                                <td><input type="checkbox" name="{{ test.id }}" onclick="checkboxSelect(this)"></td>
                                                <td>{{ test.name }}</td>
                                                <td>{{ test.priority }}</td>
                                            </tr>
                                        {% endif %}
                                    {% endfor %}
                                    </tbody>

                                </table>
                                <br />
                                <div class="row">
                                <form id="input-new{{ phase.id }}" name="../ajouter-test-audit" style="display: none" method="post" action="../administration-audit">
                                <div  class="form-group test-group">
                                    <div class="col-md-6 col-sm-6">
                                        <input type="hidden" name="idPhase" value="{{ phase.id }}">
                                        <input type="text" name="test_phase[]" class="input_test" required>
                                        <span class="highlight"></span>
                                        <span class="bar"></span>
                                        <label class="label_test">Test de phase</label>
                                        <a class="fa fa-plus-square" onclick="addInput(this)"></a>
                                        <a class="fa fa-minus-square" onclick="removeInput(this)"></a>
                                    </div>
                                </div>
                                    <div class="col-md-6 col-sm-6 col-xs-12 col-md-offset-3">
                                        <button type="submit" class="btn btn-success" name="submit" value="addTest">Soumettre</button>
                                    </div>
                                </form>
                                </div>
                                <div class="actionBar">
                                    <a class="btn btn-primary" id="{{ phase.id }}" onclick="deletePhase(this.id)">Modifier la table</a>
                                </div>
                            </div>
                        </div>
                    </div>
            {% endfor %}
                <div id="dialog-confirm-table" title="Supprimer cette table" style="display: none">
                    <p><span class="ui-icon ui-icon-alert" style="float:left; margin:12px 12px 20px 0;"></span>Etes-vous sûr de vouloir supprimer cette table? </p>
                </div>
                <div id="dialog-confirm" title="Supprimer ce test" style="display: none">
                    <p><span class="ui-icon ui-icon-alert" style="float:left; margin:12px 12px 20px 0;"></span>Etes-vous sûr de vouloir supprimer ce test? </p>
                </div>
            </div>
        </div>
    </div>


{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="../vendor/jQuery-Smart-Wizard/js/jquery.smartWizard.js"></script>
    <script src="../vendor/jquery-ui-1.12.1/jquery-ui.min.js"></script>
    <script src="//cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
    <script src="../js/jquery.knob.js"></script>

    <script>
        var i = 1;

        $( function() {
            $( "#accordion" ).accordion({
                collapsible: true,
                heightStyle: "content"

            });
                $('.myTable').DataTable({
                "language": {
                    "sProcessing": "Traitement en cours ...",
                    "sLengthMenu": "Afficher _MENU_ lignes",
                    "sZeroRecords": "Aucun résultat trouvé",
                    "sEmptyTable": "Aucune donnée disponible",
                    "sInfo": "Lignes _START_ à _END_ sur _TOTAL_",
                    "sInfoEmpty": "Aucune ligne affichée",
                    "sInfoFiltered": "(Filtrer un maximum de_MAX_)",
                    "sInfoPostFix": "",
                    "sSearch": "Chercher:",
                    "sUrl": "",
                    "sInfoThousands": ",",
                    "sLoadingRecords": "Chargement...",
                    "oPaginate": {
                        "sFirst": "Premier", "sLast": "Dernier", "sNext": "Suivant", "sPrevious": "Précédent"
                    },
                    "oAria": {
                        "sSortAscending": ": Trier par ordre croissant", "sSortDescending": ": Trier par ordre décroissant"
                    }
                }
            });
        });

        $('tbody').sortable();

        $('body').on('click', 'a.add-row', function() {
            i = i+1;
            var html = ' <tr>\n' +
                '                                                                                <td>\n' +
                '                                                                                    <div class="form-group col-md-6 col-sm-6 col-xs-12">\n' +
                '                                                                                        <input type="text" name="test_phase['+i+'][parent]" class="input_test" placeholder="Ajouter un test" required>\n' +
                '                                                                                        <div class="bar"></div>\n' +
                '                                                                                    </div>\n' +
                '                                                                                </td>\n' +
                '                                                                                <td>\n' +
                '                                                                                    <div class="form-group">\n' +
                '                                                                                        <select class="form-control" name="test_phase['+i+'][type]" id="sel1">\n' +
                '                                                                                            {% for t in test_type %}\n' +
                '                                                                                                <option>{{ t.type }}</option>\n' +
                '                                                                                            {% endfor %}\n' +
                '                                                                                        </select>\n' +
                '                                                                                    </div>\n' +
                '                                                                                </td>\n' +
                '                                                                                <td>\n' +
                '                                                                                    <div class="form-group">\n' +
                '                                                                                        <select class="form-control" name="test_phase['+i+'][prio]" id="sel1">\n' +
                '                                                                                            <option>1</option>\n' +
                '                                                                                            <option>2</option>\n' +
                '                                                                                            <option>3</option>\n' +
                '                                                                                        </select>\n' +
                '                                                                                    </div>\n' +
                '                                                                                </td>\n' +
                '                                                                                <td>\n' +
                '                                                                                    <div class="input-group col-md-6 col-sm-6 col-xs-12">\n' +
                '                                                                                        <span class="input-group-addon"><a  class="glyphicon glyphicon-minus remove-child" style=" pointer-events: none;cursor: default;"></a></span>\n' +
                '                                                                                        <input type="text" name="test_phase['+i+'][child][]" class="input_test" placeholder="Ajouter un test enfant">\n' +
                '                                                                                        <div class="bar"></div>\n' +
                '                                                                                        <span class="input-group-addon"><a href="#" class="glyphicon glyphicon-plus add-child"></a></span>\n' +
                '                                                                                    </div>\n' +
                '                                                                                </td>\n' +
                '                                                                                <td>\n' +
                '                                                                                    <a href="#" class="add-row"><span class="glyphicon glyphicon-plus"></span></a>\n' +
                '                                                                                </td>\n' +
                '                                                                            </tr>'
            $(this).closest('tr').after(html);
        })

        $('body').on('click', 'a.remove-row', function() {
            $(this).closest('tr').remove();
        })

        $('body').on('click', 'a.add-child', function() {
            $(this).closest('td').append(' <div class="input-group col-md-6 col-sm-6 col-xs-12">\n' +
                '                                                                                        <span class="input-group-addon"><a href="#" class="glyphicon glyphicon-minus remove-child"></a></span>\n' +
                '                                                                                        <input type="text" name="test_phase['+i+'][child][]" class="input_test" placeholder="Ajouter un test enfant">\n' +
                '                                                                                        <div class="bar"></div>\n' +
                '                                                                                        <span class="input-group-addon"><a href="#" class="glyphicon glyphicon-plus add-child"></a></span>\n' +
                '                                                                                    </div>')
        })

        $('body').on('click', 'a.remove-child', function() {
            $(this).closest('div.input-group').remove();
        })
    </script>

{% endblock %}
