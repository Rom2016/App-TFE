{% extends 'base.html.twig' %}

{% block stylesheets %}
    <!-- Datatables -->
    {{ parent() }}

    <link href="../vendor/jquery-ui-1.12.1/jquery-ui.min.css" rel="stylesheet">
    <link href="../css/input_custom.css" rel="stylesheet">





{% endblock %}

{% block body %}
    {{ parent() }}
    <div class="right_col" role="main">
    <div class="">
        <div class="row">
            <div class="form-group col-md-6 col-sm-6 col-xs-12 col-md-offset-3">
                <h3 class="col-xs-offset-3 col-md-offset-4" >Intitulé de la phase</h3>
                <input type="text" id="first-name" required="required" class="form-control col-md-6 col-xs-12" name="name_phase" value="{{ phase.phase_name }}">
            </div>
        </div>
    <div class="row">
    <div class="table-responsive col-md-12 col-sm-12">
        <table class="table table-hover table-striped">
            <thead>
            <tr>
                <th class="text-center">
                    Test
                </th>
                <th class="text-center">
                    Type
                </th>
                <th class="text-center">
                    Priorité
                </th>
                <th class="text-center">
                    Famille
                </th>
                <th>
                </th>
            </tr>
            </thead>
            <tbody class="sortable">
            {% set i = 1 %}
            {% for test in tests %}
            {% if test.id_parent is null %}
                <tr>
                <td>
                    <div class="form-group col-md-6 col-sm-6 col-xs-12">
                        <input type="text" name="test_phase[{{ i }}][parent]" class="input_test" value="{{ test.name }}" placeholder="Ajouter un test" required>
                        <div class="bar"></div>
                    </div>
                </td>
                <td>
                    <div class="form-group">
                        <select class="form-control" name="test_phase[1][type]" id="sel1">
                            {% for t in type %}
                                {% if t == test.type  %}
                                 <option  selected >{{ t.type }}</option>
                                {% else %}
                                    <option>{{ t.type }}</option>
                                {% endif %}
                            {% endfor %}
                        </select>
                    </div>
                </td>
                <td>
                    <div class="form-group">
                        <select class="form-control" name="test_phase[1][prio]" id="sel1">
                            <option {% if test.priority ==  1%} {{ 'selected' }} {% endif %}>1</option>
                            <option {% if test.priority ==  2%} {{ 'selected' }} {% endif %}>2</option>
                            <option {% if test.priority ==  3%} {{ 'selected' }} {% endif %}>3</option>
                        </select>
                    </div>
                </td>
                <td>
                    {% for child in tests %}
                    {% if child.id_parent == test %}
                    <div class="input-group col-md-6 col-sm-6 col-xs-12">
                        <span class="input-group-addon"><a  class="glyphicon glyphicon-minus remove-child" style=" pointer-events: none;cursor: default;"></a></span>
                        <input type="text" name="test_phase[{{ i }}][child][1][name]" class="input_test" value="{{ child.name }}" placeholder="Ajouter un test enfant">
                        <div class="bar"></div>
                        <span class="input-group-addon"><a href="#" class="glyphicon glyphicon-plus add-child" i="1"></a></span>
                        <div class="input-group-addon ">
                            <select name="test_phase[1][child][1][type]" id="sel1">
                                {% for t in type %}
                                    {% if t == child.type  %}
                                        <option  selected >{{ t.type }}</option>
                                    {% else %}
                                        <option>{{ t.type }}</option>
                                    {% endif %}
                                {% endfor %}
                            </select>
                        </div>
                        <div class="input-group-addon">
                            <select name="test_phase[1][child][1][prio]" id="sel1">
                                <option {% if child.priority ==  1%} {{ 'selected' }} {% endif %}>1</option>
                                <option {% if test.priority ==  2%} {{ 'selected' }} {% endif %}>2</option>
                                <option {% if test.priority ==  3%} {{ 'selected' }} {% endif %}>3</option>
                            </select>
                        </div>
                    </div>
                    {% endif %}
                    {% endfor %}
                </td>
                <td>
                    <a href="#" class="add-row"><span class="glyphicon glyphicon-plus"></span></a>
                </td>
            </tr>
                {% set i = i+1 %}
            {% endif %}
            {% endfor %}
            </tbody>
        </table>
    </div>
</div>
    </div>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
<script src="../vendor/jquery-ui-1.12.1/jquery-ui.min.js"></script>

<script>
    var i = 1;
    var j =1;
    $('.sortable').sortable();

    $('body').on('click', 'a.add-row', function() {
        i = i+1;
        j = j+1;
        var html = '<tr>\n' +
            '                                                                                <td>\n' +
            '                                                                                    <div class="form-group col-md-6 col-sm-6 col-xs-12">\n' +
            '                                                                                        <input type="text" name="test_phase['+i+'][parent]" class="input_test" placeholder="Ajouter un test" required>\n' +
            '                                                                                        <div class="bar"></div>\n' +
            '                                                                                    </div>\n' +
            '                                                                                </td>\n' +
            '                                                                                <td>\n' +
            '                                                                                    <div class="form-group">\n' +
            '                                                                                        <select class="form-control" name="test_phase['+i+'][type]" id="sel1">\n' +
            '                                                                                            {% for t in type %}\n' +
            '                                                                                                <option>{{ t.type }}</option>\n' +
            '                                                                                            {% endfor %}\n' +
            '                                                                                        </select>\n' +
            '                                                                                    </div>\n' +
            '                                                                                </td>\n' +
            '                                                                                <td>\n' +
            '                                                                                    <div class="form-group">\n' +
            '                                                                                        <select class="form-control" name="test_phase['+i+'][prio]" id="sel1">\n' +
            '                                                                                            <option>1</option>\n' +
            '                                                                                            <option>2</option>\n' +
            '                                                                                            <option>3</option>\n' +
            '                                                                                        </select>\n' +
            '                                                                                    </div>\n' +
            '                                                                                </td>\n' +
            '                                                                                <td>\n' +
            '                                                                                    <div class="input-group col-md-6 col-sm-6 col-xs-12">\n' +
            '                                                                                        <span class="input-group-addon"><a  class="glyphicon glyphicon-minus remove-child" style=" pointer-events: none;cursor: default;"></a></span>\n' +
            '                                                                                        <input type="text" name="test_phase['+i+'][child]['+j+'][name]" class="input_test" placeholder="Ajouter un test enfant">\n' +
            '                                                                                        <div class="bar"></div>\n' +
            '                                                                                        <span class="input-group-addon"><a href="#" class="glyphicon glyphicon-plus add-child" i='+i+'></a></span>\n' +
            '                                                                                        <div class="input-group-addon ">\n' +
            '                                                                                            <select name="test_phase['+i+'][child]['+j+'][type]" id="sel1">\n' +
            '                                                                                                {% for t in type %}\n' +
            '                                                                                                    <option>{{ t.type }}</option>\n' +
            '                                                                                                {% endfor %}\n' +
            '                                                                                            </select>\n' +
            '                                                                                        </div>\n' +
            '                                                                                        <div class="input-group-addon">\n' +
            '                                                                                            <select name="test_phase['+i+'][child]['+j+'][prio]" id="sel1">\n' +
            '                                                                                                <option>1</option>\n' +
            '                                                                                                <option>2</option>\n' +
            '                                                                                                <option>3</option>\n' +
            '                                                                                            </select>\n' +
            '                                                                                        </div>\n' +
            '                                                                                    </div>\n' +
            '                                                                                </td>\n' +
            '                                                                                <td>\n' +
            '                                                                                    <a href="#" class="remove-row"><span class="glyphicon glyphicon-minus"></span></a><a href="#" class="add-row"><span class="glyphicon glyphicon-plus"></span></a>\n\n' +
            '                                                                                </td>\n' +
            '                                                                            </tr>'
        $(this).closest('tr').after(html);
    })

    $('body').on('click', 'a.remove-row', function() {
        $(this).closest('tr').remove();
    })

    $('body').on('click', 'a.add-child', function() {
        j = j+1;
        var id = $(this).attr('i');
        $(this).closest('td').append(' <div class="input-group col-md-6 col-sm-6 col-xs-12">\n' +
            '                                                                                        <span class="input-group-addon"><a  class="glyphicon glyphicon-minus remove-child"></a></span>\n' +
            '                                                                                        <input type="text" name="test_phase['+id+'][child]['+j+'][name]" class="input_test" placeholder="Ajouter un test enfant">\n' +
            '                                                                                        <div class="bar"></div>\n' +
            '                                                                                        <span class="input-group-addon"><a href="#" class="glyphicon glyphicon-plus add-child" i="'+id+'"></a></span>\n' +
            '                                                                                        <div class="input-group-addon ">\n' +
            '                                                                                            <select name="test_phase['+id+'][child]['+j+'][type]" id="sel1">\n' +
            '                                                                                                {% for t in type %}\n' +
            '                                                                                                    <option>{{ t.type }}</option>\n' +
            '                                                                                                {% endfor %}\n' +
            '                                                                                            </select>\n' +
            '                                                                                        </div>\n' +
            '                                                                                        <div class="input-group-addon">\n' +
            '                                                                                            <select name="test_phase['+id+'][child]['+j+'][prio]" id="sel1">\n' +
            '                                                                                                <option>1</option>\n' +
            '                                                                                                <option>2</option>\n' +
            '                                                                                                <option>3</option>\n' +
            '                                                                                            </select>\n' +
            '                                                                                        </div>\n' +
            '                                                                                    </div>')
    })

    $('body').on('click', 'a.remove-child', function() {
        $(this).closest('div.input-group').remove();
    })
</script>
{% endblock %}